{% extends "layout.html" %}
{% block content %}
    <h2 class="mb-4">{{ wine.name }} ({{ wine.year }})</h2>

    <form method="POST">
  <div class="row mb-3 fs-5">
    <div class="col-md-6">
      <label for="name" class="form-label">Nom du vin</label>
      <input type="text" class="form-control" id="name" name="name" value="{{ wine.name }}" required>

      <label for="year" class="form-label mt-3">Année du vin</label>
      <input type="number" class="form-control" id="year" name="year" value="{{ wine.year }}" required>

      <label for="price" class="form-label mt-3">Prix (€)</label>
      <input type="number" step="0.01" class="form-control" id="price" name="price" value="{{ wine.price or '' }}">

      <label for="purchase_location" class="form-label mt-3">Lieu d'achat</label>
      <input type="text" class="form-control" id="purchase_location" name="purchase_location" value="{{ wine.purchase_location or '' }}">

      <label for="medals" class="form-label mt-3">Médailles</label>
      <input type="text" class="form-control" id="medals" name="medals" value="{{ wine.medals or '' }}">

      <label for="expiration_date" class="form-label mt-3">Date d'expiration</label>
      <input type="date" class="form-control" id="expiration_date" name="expiration_date"
             value="{{ wine.expiration_date }}">
    </div>

    <div class="col-md-6">
      <label for="type" class="form-label">Type</label>
      <input type="text" class="form-control" id="type" name="type" value="{{ wine.type }}" required>

      <label for="quantity" class="form-label mt-3">Quantité (en bouteille)</label>
      <input type="number" class="form-control" id="quantity" name="quantity" value="{{ wine.quantity }}" required>

      <label for="volume_ml" class="form-label mt-3">Volume de la bouteille (ml)</label>
      <input type="number" class="form-control" id="volume_ml" name="volume_ml" value="{{ wine.volume_ml or '' }}">

      <label for="cellar_slot" class="form-label mt-3">Emplacement dans la cave</label>
      <input type="text" class="form-control" id="cellar_slot" name="cellar_slot" value="{{ wine.cellar_slot or '' }}">

      <label for="region_id" class="form-label mt-3">Région</label>
      <select class="form-select" id="region_id" name="region_id">
        <option value="">-- Sélectionnez une région --</option>
        {% for region in regions %}
          <option value="{{ region.id }}" {% if wine.region and wine.region.id == region.id %}selected{% endif %}>
            {{ region.name }}
          </option>
        {% endfor %}
      </select>
    </div>
  </div>

  <div class="col-12 mt-3">
    <button type="submit" class="btn btn-primary">Sauvegarder les changements <i class='bx bx-edit'></i></button>
    <a href="{{ url_for('delete_wine', wine_id=wine.id) }}" class="btn btn-danger ms-2">Supprimer le vin <i class='bx bx-trash'></i> </a>
  </div>
</form>

<form method="POST" action="{{ url_for('toggle_favorite', wine_id=wine.id) }}">
    <button type="submit" class="btn btn-warning mt-3">
        {% if wine.is_favorite %}★ Supprimer le favori{% else %}Mettre en favori ☆{% endif %}
    </button>
</form>


<hr class="my-4">

<!-- Formulaire pour modifier uniquement la quantité -->
<form method="POST" action="{{ url_for('consume_wine', wine_id=wine.id) }}" class="fs-5">
  <div class="mb-3">
    <label for="consumed" class="form-label">Mise à jour rapide: combien de bouteille avez-vous bu ?</label>
    <input type="number" class="form-control" id="consumed" name="consumed" required>
  </div>
  <button type="submit" class="btn btn-warning">Valider</button>
</form>


<h3 class="mt-5">Ajouter un événement</h3>
<form method="post" action="{{ url_for('add_event', wine_id=wine.id) }}" class="row g-3">
  <div class="col-md-6">
    <label for="people" class="form-label">Personnes</label>
    <input type="text" class="form-control" id="people" name="people" placeholder="Ex: Paul, Marie">
  </div>

  <div class="col-md-6">
    <label for="food" class="form-label">Plat ou accompagnement</label>
    <input type="text" class="form-control" id="food" name="food" placeholder="Ex: Fromage, viande rouge">
  </div>

  <div class="col-12">
    <label for="notes" class="form-label">Notes</label>
    <textarea class="form-control" id="notes" name="notes" rows="3" placeholder="Moment, ambiance, etc."></textarea>
  </div>

  <div class="col-md-4">
    <label for="consumed_bottles" class="form-label">Bouteilles consommées</label>
    <input type="number" class="form-control" id="consumed_bottles" name="consumed_bottles" min="1" max="{{ wine.quantity }}" required>
  </div>

  <div class="col-12">
    <button type="submit" class="btn btn-primary mt-2">Ajouter l'événement</button>
  </div>
</form>

{% if events %}
  <h4 class="mt-5">Événements passés</h4>
  <ul class="list-group">
    {% for event in events %}
      <li class="list-group-item">
        <strong>{{ event.date }}</strong> :
        <span class="text-muted">({{ event.consumed_bottles }} bouteille{{ 's' if event.consumed_bottles > 1 else '' }})</span><br>
        {% if event.people %}<strong>Avec :</strong> {{ event.people }}<br>{% endif %}
        {% if event.food %}<strong>Plat :</strong> {{ event.food }}<br>{% endif %}
        {% if event.notes %}<strong>Notes :</strong> {{ event.notes }}{% endif %}
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p class="mt-3 text-muted">Aucun événement enregistré pour ce vin.</p>
{% endif %}


{% endblock %}
